<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Demande de réservation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background-color: #f9f9f9;
    }

    h2 {
      text-align: center;
      color: #333;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }

    input, textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0 16px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background-color: #45a049;
    }

    #message {
      text-align: center;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h2>Demande de réservation</h2>

  <form id="bookingForm">
    <label for="ownerName">👤 Nom et prénom du propriétaire :</label>
    <input type="text" id="ownerName" name="ownerName" required>

    <label for="email">📧 Email :</label>
    <input type="email" id="email" name="email" required>

    <label for="authorizedPerson">👥 Personne habilitée à reprendre le(s) pensionnaire(s) :</label>
    <input type="text" id="authorizedPerson" name="authorizedPerson">

    <label for="animalCount">🐾 Nombre d'animaux :</label>
    <input type="number" id="animalCount" name="animalCount" min="1" required>

    <label for="animalNames">🐶 Nom(s) de vos compagnon(s) :</label>
    <input type="text" id="animalNames" name="animalNames" required>

    <label for="arrivalDate">📅 Date de début de séjour :</label>
    <input type="date" id="arrivalDate" name="arrivalDate" required>

    <label for="arrivalTime">⏰ Heure de début de séjour :</label>
    <input type="time" id="arrivalTime" name="arrivalTime" step="900" value="09:00" required>

    <label for="departureDate">📅 Date de fin de séjour :</label>
    <input type="date" id="departureDate" name="departureDate" required>

    <label for="departureTime">⏰ Heure de fin de séjour :</label>
    <input type="time" id="departureTime" name="departureTime" step="900" value="18:00" required>

    <label for="remarks">📝 Remarques :</label>
    <textarea id="remarks" name="remarks" rows="4" placeholder="Allergies, habitudes, instructions particulières..."></textarea>

    <button type="submit">Réserver</button>
  </form>

  <p id="message"></p>

  <script>
    // Horaires d'ouverture par jour (0 = dimanche, ..., 6 = samedi)
    const horaires = {
      0: [ { debut: "17:00", fin: "19:00" } ],
      1: [ { debut: "09:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ],
      2: [ { debut: "09:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ],
      3: [ { debut: "09:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ],
      4: [ { debut: "09:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ],
      5: [ { debut: "09:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ],
      6: [ { debut: "10:00", fin: "14:00" }, { debut: "17:00", fin: "19:00" } ]
    };

    // Bloquer les dates passées et préremplir les champs
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];

      const arrivalDateInput = document.getElementById('arrivalDate');
      const departureDateInput = document.getElementById('departureDate');

      arrivalDateInput.value = today;
      departureDateInput.value = today;
      arrivalDateInput.min = today;
      departureDateInput.min = today;
    });

    // Vérifie si l'heure choisie est dans une des plages d'ouverture du jour
    function checkHoraire(dateStr, timeStr) {
      if (!dateStr || !timeStr) return false;
      const date = new Date(`${dateStr}T${timeStr}`);
      const day = date.getDay();
      const plages = horaires[day];
      if (!plages || plages.length === 0) return false;
      return plages.some(plage => timeStr >= plage.debut && timeStr <= plage.fin);
    }

    document.getElementById('bookingForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const arrivalDate = document.getElementById('arrivalDate').value;
      const arrivalTime = document.getElementById('arrivalTime').value;
      const departureDate = document.getElementById('departureDate').value;
      const departureTime = document.getElementById('departureTime').value;
      const message = document.getElementById('message');

      // Vérifie que les horaires sont dans les créneaux d’ouverture
      if (!checkHoraire(arrivalDate, arrivalTime)) {
        message.textContent = "⛔ L'heure d'arrivée est en dehors des horaires d'ouverture.";
        message.style.color = "red";
        return;
      }

      if (!checkHoraire(departureDate, departureTime)) {
        message.textContent = "⛔ L'heure de départ est en dehors des horaires d'ouverture.";
        message.style.color = "red";
        return;
      }

      // Vérifie que l’arrivée est avant le départ
      const start = new Date(`${arrivalDate}T${arrivalTime}`);
      const end = new Date(`${departureDate}T${departureTime}`);
      if (start >= end) {
        message.textContent = "⛔ La date/heure d'arrivée doit être antérieure à celle du départ.";
        message.style.color = "red";
        return;
      }

      // Prépare les données à envoyer
      const data = {
        ownerName: document.getElementById('ownerName').value,
        email: document.getElementById('email').value,
        authorizedPerson: document.getElementById('authorizedPerson').value,
        animalCount: document.getElementById('animalCount').value,
        animalNames: document.getElementById('animalNames').value,
        arrivalDate,
        arrivalTime,
        departureDate,
        departureTime,
        remarks: document.getElementById('remarks').value
      };

      // Remplace par l’URL de ton script Apps Script
      const scriptURL = "https://script.google.com/macros/s/AKfycbxeR4nPp5QwLFFZ6pYgEVdbtODNU6BdoiyffhA8nRrytyEzNUfHGAybPtiq46eSdFNyWA/exec";

      fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(() => {
        message.textContent = "✅ Réservation enregistrée avec succès.";
        message.style.color = "green";
        document.getElementById('bookingForm').reset();
      })
      .catch((error) => {
        console.error("Erreur :", error);
        message.textContent = "❌ Une erreur s'est produite.";
        message.style.color = "red";
      });
    });
  </script>

</body>
</html>
